## STM32 术语手册

### 定时器

`RCC 时钟控制模块（Reset and Clock Control）`

- 控制系统的时钟和复位功能
- 对系统时钟进行各种配置和管理
- 负责控制系统的复位功能

<br>

`TIM 定时器/计数器（Timer/Counter）`

- 可设置多个通道，如定时器模式、输入捕获模式、输出比较模式或 PWM 输出模式
- 可以由内部时钟源或外部时钟源驱动，还可以通过预分频器和自动重载寄存器（ARR）来实现更灵活的计时控制

<br>

`PSC 预分频器寄存器（Prescaler Register）`

- 设置定时器/计数器的时钟预分频系数，以改变计时器时钟的频率
- 用于改变计数器的计数速度
- 将定时器/计数器时钟源的频率除以预分频系数，从而得到更低的计数速度

<br>

`CNT 计数器寄存器（Counter Register）`

- 用于储存定时器/计数器的计数值
- 可以在达到指定计数值时触发相应的事件或中断
- PWM 控制中，可以通过读取定时器/计数器的计数器寄存器来判断何时应该改变 PWM 输出的电平状态

<br>

`影子寄存器`  
通常存在于定时器与 DMA 中，即同一寄存器划分为主次两个寄存器，主寄存器可被程序员操作，而次寄存器则不可见；  
次寄存器即为影子寄存器，常用于保存上一步执行的数据；

<br>

`时钟使能`

- 指通过设置相关的寄存器来启用或关闭特定的外设或功能模块所需的时钟信号；
- STM32 外设众多，故基本上每一个外设都被分配一个专属时钟使能
- 时钟系统由多个时钟源、时钟树和分频器组成，可以生成多个时钟信号，为不同的外设和模块提供时钟信号

<br>

`分频系数`

- 它是用于控制时钟频率的一种参数
- 分频系数越大，分频后的时钟频率越低，定时或计数的时间就越长

<br>

`ARR 自动重装值寄存器 （Auto-reload register）`

- 它用于设定计数器计数的上限值，当计数器计数达到自动重装值时，计数器会重新从 0 开始计数
- 在定时器应用中，自动重装值决定了定时器的定时周期
- 在计数器应用中，自动重装值决定了计数器的计数上限

<br>

`计数方式`

- 向上计数模式（Up-counting Mode）：计数器从 0 开始，每计数一次计数值加 1，当计数值达到自动重装值时，计数器重新从 0 开始计数。
- 向下计数模式（Down-counting Mode）：计数器从自动重装值开始，每计数一次计数值减 1，当计数值减到 0 时，计数器重新从自动重装值开始计数。
- 向上/向下计数模式（Up/Down-counting Mode）：计数器从自动重装值开始向上计数，当计数值达到自动重装值时，计数器开始向下计数，当计数值减到 0 时，计数器重新从自动重装值开始向上计数。

<br>

<br>

### 看门狗

<br>

### 中断

`NVIC 嵌套中断向量控制器（Nested Vectored Interrupt Controller）`

- 负责管理所有外部和内部中断请求，并且支持多级中断嵌套
- 可以优先级和向量号（即中断服务函数的地址）来区分和处理不同的中断请求
- 可以实现多任务处理、实时控制和事件驱动等功能

<br>

`ISR 中断服务程序（Interrupt Service Routine）`

- 指在中断发生时被调用的一段代码
- 当中断事件发生时，CPU 会暂停当前任务的执行，进入中断服务程序执行相应的处理
- 在执行中断服务程序时，CPU 会自动保存当前任务的上下文
- 中断服务程序通常需要先在向量表中注册，以便在中断发生时能够被正确地调用

<br>

### PWM 脉冲宽度调制

`CCR 捕获比较寄存器（Capture/Compare Register，CCR）`

- 在捕获模式下，CCR 用于捕获外部信号的时间戳
- 在比较模式下，CCR 用于比较计数器的值，从而实现 PWM 输出等功能

<br>

`刹车死区寄存器`  
用于控制电机驱动器中刹车死区时间的寄存器

`DTG（Dead-Time Generator）`

- 配置刹车死区时间的寄存器，用于防止功率半导体器件（如 MOSFET 或 IGBT）在切换时出现短路故障
- 可以配置用于产生刹车死区的时间间隔

<br>

`滤波器`

- 用于对模拟信号进行滤波处理，以去除噪声、滤波干扰、改善信号质量
- 硬件滤波器是由一组 RC 电路组成的低通滤波器，主要用于抑制高频噪声和滤波干扰，保证输入信号的稳定性和精确性
- 软件滤波器是由 CPU 实现的滤波器，主要用于实现滤波器的高级功能，如带通滤波、带阻滤波、滑动平均滤波

<br>

### 寄存器与存储器

#### FSMC

> 外部存储器接口（Flexible Static Memory Controller）

- STM32 微控制器系列中用于连接外部存储器（如 SRAM、NAND Flash、NOR Flash 等）的接口
- 支持异步、同步和多通道数据传输模式

FSMC 将外部设备分为 2 类：`NOR/PSRAM` 设备、
`NAND/PC` 卡设备

FSMC 将外部存储器划分为固定大小为 256M 字节的四个存储块（Bank），统共管理 1GB 空间

`存储块 1（Bank1）` 被分为 4 个区，每个区管理 64M 字节空间，每个区都有独立的寄存器对所连接的存储器进行配置

<br>

#### RNG

> RNG（Random Number Generator）随机数生成器

随机数生成器的输入来自于两个独立的噪声源：硬件噪声和内部温度传感器。这些噪声源被放大、采样并处理成一个随机数字

使用步骤：先启动时钟，并配置相应的中断或轮询模式，然后读取 `RNG_DR` 寄存器中的数据  
（读取 `RNG_DR` 寄存器前，应该先检查 SR 寄存器中的 DRDY 标志位，以确保数据可用）

`RNG_LFSR 线性反馈移位寄存器`  
由专用时钟提供时钟信息，即种子，之后 RNG_LFSR 会把种子传递给 RNG_DR

`RNG_SR` 用于检测当专用时钟制作的种子出现异常或者时钟频率不对时，会自动读取对应列，且可人为设置对应中断

<br>

#### BKP

> BKP（Backup registers）是备份寄存器

通过对 BKP 寄存器进行读写来保证数据在掉电后仍然可持久存储

重新上电后可再次通过 BKP 获取数据以恢复状态

BKP 可通过电磁攻击以及侧信道攻击非法篡改数据，故不是十分安全

<br>

### 时钟

#### RTC 时钟

> STM32F4 的 RTC，是一个独立的 BCD 定时器/计数器。并且提供日历功能

RTCCLK 为 RTC 的时钟源，为独立的时钟模块  
LSE 与 RTCCLK 结合最为密切

RTCCLK 初始化时必须要和系统主时钟进行同步！

<br>

#### LSE 时钟

> LSE 时钟 低速外部晶振（Low Speed External oscillator）时钟

一般以外部 32.768kHz 晶体振荡器作为时钟源

稳定性和精度非常高，可以在掉电和复位后自动恢复，并且可以提供秒级别的计时精度

<br>

#### LSI 时钟

> LSI 时钟 低速内部晶振（Low Speed Internal oscillator）时钟

由内部 RC 振荡器提供，通常使用 40kHz 的频率

受环境温度与工作电压影响较大，成本低但精度不高

<br>

#### HSE 时钟

> HSE 时钟 高速外部晶振（High Speed External oscillator）时钟

稳定性与精度极高，提供 MHz 级别时钟信号

常用于高速串行通信、定时器、中断处理等高性能时钟

<br>

#### BIN 与 BCD

BIN 是指二进制数（Binary）  
BCD 是指二进制编码十进制数（Binary Coded Decimal）

BCD 比二进制数占用更多的存储空间，但无需进行二进制到十进制的转换

BIN BCD 常用于数字表示与时钟芯片等场合

<br>

#### HCLK

> HCLK 表示 CPU 总线时钟

`HCLK` 的频率取决于外部晶振或内部 RC 振荡器的时钟源，可以通过配置寄存器进行设置

<br>

#### PLL

> PLL 是 Phase Locked Loop 的缩写，翻译过来是“锁相环”

用于产生稳定的高频时钟信号

`PLL` 通常由一个比较器、一个 `VCO（Voltage Controlled Oscillator）`、一个相位检测器和一个反馈回路组成

PLL 常用于将外部晶振的低频时钟信号倍频或分频，产生更高频率的系统时钟信号

<br>

### 总线

#### AHB

> AHB 是 Advanced High-performance Bus 的缩写，翻译过来是“高级高性能总线”

使用该总线，CPU 可以直接访问内部的存储器和外设，还提供了一些控制和管理信号，如时钟、复位、中断等，用于协调各个模块的工作

AHB 的带宽问题为限制整个系统速率与性能的关键指标

<br>

#### APB

> APB 全称为 Advanced Peripheral Bus

用于连接各种外设和低速模块，如 GPIO、UART、SPI

APB1 链接低速外设  
APB2 链接高速外设

APB 总线的时钟来源于 AHB 总线，可以通过 APB 分频系数的设置来调整 APB 总线的工作频率和性能

<br>

#### AXI

> AXI 全称为 Advanced eXtensible Interface，是一种高级的总线结构

支持高速数据处理，最高传输速率可达 10Gbps 以上

低延迟、可扩展性高、具有极佳的兼容性与可靠性

常用于链接复杂外设，譬如 DMA、Ethernet、USB

<br>

#### FSMC

> FSMC 全称为 Flexible Static Memory Controller

最高传输速率可达 100MHz 以上

FSMC 总线通常用于连接高速、大容量的存储器，如 LCD 显示屏、图像处理器、音频处理器等

<br>

#### SDIO

> SDIO 全称为 Secure Digital Input/Output，是一种基于 SD 卡物理接口的高速数据传输标准

STM32 的一个高速外设模块，提供 SD 与 MMC 卡接口

支持多种传输协议，包括 SPI 模式与 SD 卡协议

<br>

### ADC & DAC

<br>

### 电源引脚

`VCC(circuit)` 表示接入电路的电压  
`VDD(device)` 表示接入元器件的内部电压  
`VEE` 负电压供电（如场效应管源级）  
`VSS(series)` 表示公共链接，指电路公共端的接地电压

<br>

`VBAT` 当其接入外部电源是，在 VCC 断电后可备份寄存器内容与维持 RTC；当其不接入外部电源时，应当将其和 VCC 接在一起

<br>

### 外部晶振

#### XTAL 引脚

当 MCU 使用无源晶振时，需要将外部晶振链接到 XTAL 与 EXTAL 两个引脚上；  
无源晶振成本低廉，但无起振器，且必须要和外部电容参数匹配才可

无源晶振无需外部供电电压，仅有输入输出端

<br>

#### EXTAL 引脚

当 MCU 使用有源晶振时，MCU 内部封装好了起振片，只需要为 EXTAL 口提供 VCC 和 GND 即可让晶振开始工作

有源晶振需额定供电电压，但无需外部电容匹配

<br>
