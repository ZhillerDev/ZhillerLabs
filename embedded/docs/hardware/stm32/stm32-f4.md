### 前言

> 实验采用正点原子他探索者 V2 开发板（STM32F407ZG）

由于正点自带的指南手册对于库函数、寄存器、HAL 库三大开发方式都已经做了详细的介绍，这里就不费多余墨水重复阐述

仅就关键点以及重要寄存器进行原理与使用方式的介绍，用于基础知识巩固与扩展视野

部分内容由 AI 生成，请仔细校验其正误

<br>

### 跑马灯实验

标准 STM32 开发文件目录结构及其对应功用简述

- `FWLib` 存放 ST 官方提供的固件库函数
- `CORE` 存放固件库必须的核心文件和启动文件（基本无需修改）
- `SYSTEM` 是 ALIENTEK 提供的共用代码
- `HARDWARE` 存放每个实验的外设驱动代码
- `USER` 存放用户代码与入口文件 main.c

<br>

#### GPIO 通用输入输出引脚

`GPIO` 有三种工作模式

1. 输入模式下，GPIO 可以读取外部输入电平，如按键、传感器
2. 输出模式下，GPIO 可以控制外部输出电平，如 LED 灯、电机
3. 复用模式下，GPIO 可以同时作为输入和输出使用

> STM32F4xx 系列优化了 GPIO，虽然更复杂了，但是使用可选择性增加了

<br>

#### IO 配置常用 8 个寄存器

`MODER` 寄存器，该寄存器是 GPIO 端口模式控制寄存器  
`OTYPER` 寄存器，该寄存器用于控制 GPIOx 的输出类型  
`OSPEEDR` 寄存器，该寄存器用于控制 GPIOx 的输出速度  
`PUPDR` 寄存器，该寄存器用于控制 GPIOx 的上拉/下拉

`ODR` 寄存器，该寄存器用于控制 GPIOx 的输出  
`IDR` 寄存器，该寄存器用于读取 GPIOx 的输入  
`32 位置位/复位寄存器 (BSRR)`，这个寄存器是用来置位或者复位 IO 口

`（AFRH 和 AFRL）`，这两个寄存器是用来设置 IO 口的复用功能

<br>

### 蜂鸣器实验

> 有源蜂鸣器自带震荡电路，仅需对其施加高低电平即可发出鸣叫声

<br>

#### S8050

一种 NPN 型晶体管，封装形式为 TO-92，常用于低功率放大和开关电路

最大集电极电压为-40V，最大集电极电流为 0.5A，最大功率为 0.625W

<br>

### 串口通信实验

根据官方指导书，可得调用串口通信的模板

1. 串口时钟使能，GPIO 时钟使能。
2. 设置引脚复用器映射：调用 GPIO_PinAFConfig 函数。
3. GPIO 初始化设置：要设置模式为复用功能。
4. 串口参数初始化：设置波特率，字长，奇偶校验等参数。
5. 开启中断并且初始化 NVIC，使能中断（如果需要开启中断才需要这个步骤）。
6. 使能串口。
7. 编写中断处理函数：函数名格式为 USARTxIRQHandler(x 对应串口号)。

<br>

`USART_DR` 一个双寄存器，向其写数据后会自动发送，他也可以接收并存储外来的数据  
`USART_SR` 状态寄存器，表示数据收发状态

<br>

#### NVIC 嵌套向量中断控制器

NVIC 于 STM 系列开发板中，用于处理中断请求

NVIC 支持多级中断优先级，每个中断请求都有一个优先级，可以通过配置 NVIC 的优先级分组来进行优先级管理

NVIC 还支持嵌套中断

<br>

### 外部中断实验

#### SYSCFG 系统配置控制器

要负责一些系统级别的配置和控制

- 中断线映射：通过 SYSCFG 的 EXTICR 寄存器，可以将外部中断线映射到对应的 GPIO 引脚上，方便实现外部中断的处理。
- I/O 端口映射：通过 SYSCFG 的 CFGR1 寄存器，可以将某些 I/O 端口映射到不同的功能模块上，例如将 I2C 接口的 SDA 和 SCL 引脚映射到 PB9 和 PB8 引脚上。
- 互联矩阵控制：在某些 STM32 单片机中，SYSCFG 还可以控制芯片内部的互联矩阵，实现不同模块之间的连接和控制。
- VBAT 电压监测：在某些 STM32 单片机中，SYSCFG 还可以监测 VBAT 电压，以确保系统在低电压情况下的正常工作。

<br>

#### 中断函数

STM32F4 的外部中断 0~4 都有单独的中断服务函数，但是从 5 开始，他们就没有单独的服务函数了，而是多个中断共用一个服务函数

<br>

### 独立看门狗实验

STM32F4 的独立看门狗由内部专门的 32Khz 低速时钟（`LSI`）驱动

什么是看门狗：看门狗就是一个计时器，一旦启动，倒计时结束后立刻进行程序复位，这有助于当系统卡死时自动复位；所有我们需要在倒计时快要截止前重载计时器（俗称喂狗）

<br>

#### 关键寄存器

`IWDG_KR 关键字寄存器`：写入 0xCCCC，开始启用独立看门狗；此时计数器开始从其复位值 0xFFF 递减计数。当计数器计数到末尾 0x000 时，会产生一个复位信号(IWDG_RESET)

`IWDG_PR(预分频计数器)` 和 `IWDG_RLR(重装载寄存器)` 寄存器具有写保护功能。要修改这两个寄存器的值，必须先向 `IWDG_KR` 寄存器中写入 0x5555

对 `IWDG_KR` 输入 `0xAAAA` 进行喂狗（事件把控好，因为硬件原因，看门狗计时器不一定完全准确按照指定频率，所以务必提前一些）

强制修改具有写保护的 IWDG_PR 和 IWDG_RLR，将会导致序列错乱

<br>

### 窗口看门狗实验
